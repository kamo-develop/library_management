# API для Управления Библиотекой

RESTful API для управления библиотечным каталогом. 
Система позволяет управлять информацией о книгах, авторах, читателях и выдачей книг. 
В проекте реализовано: 
* регистрация и аутентификация пользователей с использованием JWT токенов 
* разделение пользователей на роли: администратор и читатель
* администратор может управлять всеми ресурсами, читатель — только просмотр и взаимодействие с книгами

## Запуск

### Запуск с использованием docker

Для запуска приложения с использованием docker необходимо в корне проекта выполнить команду
```console
docker compose up
```
И перейти по адресу: http://0.0.0.0:8000/docs

При запуске автоматически создаётся администратор (username: admin password: 123)
#
Для запуска тестов с использованием docker необходимо в корне проекта выполнить команду
```console
docker compose -f test-docker-compose.yml up
```
#
### Запуск без docker
* Создать базу данных postgresql для приложения.
* Создать файл настроек `.env`, скопировав `.env.dist`, и указать в нём параметры для доступа к базе данных. 
* В проекте используется система управления зависимостями poetry, поэтому для запуска необходимо её установить
* Затем в корне проекта выполнить команду для установки всех зависимостей
```console
poetry install
```
* И команду для запуска виртуального окружения
```console
poetry shell
```
* Выполнить миграции alembic
```console
alembic upgrade head
```
* Выполнить скрипт для создания администратора
```console
python -m init_db
```
* Запустить непосредственно приложение
```console
python -m main
```
#
Для запуска тестов необходимо создать отдельную базу данных, 
указать параметры для доступа к ней в файле `.env` и выполнить команду: 
```console
pytest tests/ -v
```

## Архитектура

Модели базы данных описаны в файле `models.py`.
Схемы pydantic для входных и выходных данных - в файле `schemas.py`

В пакете `book` находятся сервисы и эндпоинты, реализующие работу с книгами, авторами, а также выдачу и возврат книг

В пакете `user` находятся сервисы и эндпоинты, реализующие регистрацию, аутентификация и управление пользователями.
Для аутентификации используются JWT. Срок жизни токена можно указать в файле `.env` изменив параметр `ACCESS_TOKEN_EXPIRE_MINUTES`

В файле `deps.py` находятся зависимости, например функция для получения текущего авторизованного пользователя

### Структура базы данных

Ниже приведена схема базы данных, содержащая сущности для пользователя, автора, книги, и выдачи книги пользователю

![Image](https://github.com/user-attachments/assets/c0303fd6-a6ad-4acd-80a0-4db4230037c8)
